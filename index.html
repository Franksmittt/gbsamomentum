<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Collective // Momentum Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Apex Collective: Foundational Styling - Precision & Elegance */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Deep, focused dark theme */
            color: #E5E7EB;
            overflow-x: hidden;
        }
        .app-bg {
            background-image: radial-gradient(circle at top, rgba(31, 41, 55, 0.5) 0%, rgba(17, 24, 39, 0) 40%);
        }
        .kanban-column {
            transition: background-color 0.3s ease;
        }
        .idea-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease;
            cursor: grab;
        }
        .idea-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(99, 102, 241, 0.3); /* Subtle indigo glow */
            background-color: #1f2937;
        }
        .dragging {
            opacity: 0.8;
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            background-color: #374151;
        }
        .drag-over {
            background-color: rgba(99, 102, 241, 0.1); /* Indigo highlight on drag-over */
        }
        .apex-button {
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .apex-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        /* Apex Collective: Innovative Micro-interactions */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        .suggestion {
            border-left: 2px solid #4f46e5;
        }
    </style>
</head>
<body class="antialiased">
    <!-- App Container -->
    <div id="app-container" class="min-h-screen flex flex-col p-4 md:p-6 lg:p-8 app-bg">
        
        <!-- Header - Apex Collective: Storytelling & Focus -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight">Creative Center</h1>
            <p class="text-gray-400 mt-2 max-w-2xl mx-auto">A collaborative space for innovation and strategy. Drag concepts to align our focus.</p>
        </header>

        <!-- Control Bar -->
        <div class="mb-6 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <!-- User Info: Integrated & Understated -->
            <div class="flex items-center space-x-4">
                <div id="user-info" class="text-sm text-gray-400 bg-gray-800/50 border border-gray-700 px-4 py-2 rounded-lg text-center">
                    Loading session...
                </div>
                <div id="logged-in-user" class="text-sm text-white bg-indigo-600/50 border border-indigo-500 px-4 py-2 rounded-lg font-semibold text-center">
                    Not Logged In
                </div>
            </div>
             <div class="flex items-center space-x-4">
                <button id="add-idea-btn" class="apex-button px-5 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500/50">
                    + New Concept
                </button>
                <button id="toggle-view-btn" class="apex-button px-5 py-2 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-600/50 min-w-[180px]">
                    Synthesize Results
                </button>
            </div>
        </div>

        <!-- Kanban Board - Architect's Precision in Layout -->
        <main id="kanban-board" class="flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Columns will be injected here by JavaScript -->
        </main>
        
        <!-- Results View - Innovative Data Visualization -->
        <main id="results-view" class="hidden flex-1 flex flex-col items-center">
            <div class="w-full max-w-5xl bg-gray-900/50 border border-gray-700 p-6 rounded-xl shadow-2xl">
                <h2 class="text-3xl font-bold text-center mb-6 text-white">Ideation Synthesis</h2>
                <div id="results-list" class="space-y-4">
                    <!-- Results will be injected here -->
                </div>
            </div>
        </main>

        <!-- Loading Spinner -->
        <div id="loader" class="fixed inset-0 bg-gray-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50">
            <svg class="animate-spin h-10 w-10 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

        <!-- Add/Edit Idea Modal - A Focused Creation Space -->
        <div id="idea-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-md hidden items-center justify-center p-4 z-40">
            <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-2xl p-6 w-full max-w-md" id="idea-modal-content">
                <h3 id="idea-modal-title" class="text-xl font-bold mb-6 text-white">Propose a New Concept</h3>
                <form id="idea-form">
                    <input type="hidden" id="idea-id">
                    <div class="mb-4">
                        <label for="idea-title" class="block text-sm font-medium text-gray-300 mb-2">Concept Title</label>
                        <input type="text" id="idea-title" required class="w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white" placeholder="e.g., 'Interactive Client Onboarding' Campaign">
                    </div>
                    <div class="mb-6">
                        <label for="idea-description" class="block text-sm font-medium text-gray-300 mb-2">The Core Narrative</label>
                        <textarea id="idea-description" rows="4" required class="w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white" placeholder="Explain the essential idea and its intended impact..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-idea-btn" class="apex-button px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                        <button type="submit" class="apex-button px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-500">Submit Concept</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Suggestion Modal -->
        <div id="suggestion-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-md hidden items-center justify-center p-4 z-40">
            <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-2xl p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-6 text-white">Add a Suggestion</h3>
                <form id="suggestion-form">
                    <input type="hidden" id="suggestion-idea-id">
                    <div class="mb-6">
                        <label for="suggestion-text" class="block text-sm font-medium text-gray-300 mb-2">Your Insight</label>
                        <textarea id="suggestion-text" rows="4" required class="w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white" placeholder="e.g., 'Great idea, but let's consider targeting this towards the B2B sector first...'"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-suggestion-btn" class="apex-button px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                        <button type="submit" class="apex-button px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-500">Submit Suggestion</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:xxxxxxxxxxxxxxxxxxxxxx"
        };
        const appId = 'local-dev-instance';
        const initialAuthToken = undefined;

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, setDoc, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- MOCK DATA & APP STATE ---
        let app, db, auth, userId, currentUser;
        let ideas = [];
        let userVotes = {};
        let sessionState = { status: 'voting' };
        
        const teamColors = {
            'Frank': 'border-blue-400',
            'Charmain': 'border-pink-400',
            'Drikus': 'border-green-400',
            'Liam': 'border-yellow-400',
            'Default': 'border-gray-500'
        };

        const initialMockIdeas = [
            { id: 'mock1', title: 'Q4 Social Media Overhaul', description: 'Complete refresh of our visual identity on Instagram and LinkedIn to target a younger demographic.', author: 'Frank', suggestions: [
                { author: 'Liam', text: 'Good idea. We should focus heavily on TikTok and Reels content.'}
            ]},
            { id: 'mock2', title: 'Interactive Client Workshops', description: 'Host quarterly online workshops to educate clients on new marketing trends and our services.', author: 'Charmain', suggestions: [] },
            { id: 'mock3', title: 'AI-Powered Analytics Dashboard', description: 'Develop a new internal dashboard that uses AI to predict campaign performance and suggest optimizations.', author: 'Liam', suggestions: [
                 { author: 'Frank', text: 'This could be a huge value-add. Let\'s scope the technical requirements.' },
                 { author: 'Drikus', text: 'Can we integrate this with our current CRM?' }
            ]}
        ];

        // DOM Elements
        const kanbanBoard = document.getElementById('kanban-board');
        const resultsView = document.getElementById('results-view');
        const resultsList = document.getElementById('results-list');
        const toggleViewBtn = document.getElementById('toggle-view-btn');
        const userInfoEl = document.getElementById('user-info');
        const loggedInUserEl = document.getElementById('logged-in-user');
        const loader = document.getElementById('loader');
        
        const addIdeaBtn = document.getElementById('add-idea-btn');
        const ideaModal = document.getElementById('idea-modal');
        const ideaModalTitle = document.getElementById('idea-modal-title');
        const cancelIdeaBtn = document.getElementById('cancel-idea-btn');
        const ideaForm = document.getElementById('idea-form');
        const ideaIdInput = document.getElementById('idea-id');

        const suggestionModal = document.getElementById('suggestion-modal');
        const suggestionForm = document.getElementById('suggestion-form');
        const cancelSuggestionBtn = document.getElementById('cancel-suggestion-btn');
        const suggestionIdeaIdInput = document.getElementById('suggestion-idea-id');
        
        const columns = [
            { id: 'ideas', title: 'Concept Backlog', borderColor: '#4B5563' },
            { id: 'good', title: 'High Conviction', borderColor: '#22C55E' },
            { id: 'maybe', title: 'Further Discussion', borderColor: '#EAB308' },
            { id: 'bad', title: 'Low Priority', borderColor: '#EF4444' },
        ];

        // --- INITIALIZATION ---
        async function init() {
            currentUser = 'Frank'; // Change this to 'Charmain', 'Drikus', or 'Liam' to test
            loggedInUserEl.innerHTML = `Logged in as <strong>${currentUser}</strong>`;

            try {
                if (firebaseConfig.apiKey.includes("XXXX")) {
                    throw new Error("Firebase not configured. Running in local mode with mock data.");
                }
                // Firebase logic will go here
            } catch (error) {
                console.warn(error.message);
                userInfoEl.textContent = "Local Mode";
                ideas = initialMockIdeas;
                updateView();
            }
        }
        
        // --- VIEW & RENDERING LOGIC ---
        function updateView() {
            loader.classList.add('hidden');
            if (sessionState.status === 'voting') {
                kanbanBoard.classList.remove('hidden');
                resultsView.classList.add('hidden');
                renderVotingBoard();
            } else {
                kanbanBoard.classList.add('hidden');
                resultsView.classList.remove('hidden');
                renderResultsView();
            }
        }

        function renderVotingBoard() {
            kanbanBoard.innerHTML = '';
            columns.forEach(column => {
                const columnEl = document.createElement('div');
                columnEl.className = `kanban-column flex flex-col bg-gray-800/50 border border-gray-700 rounded-lg shadow-lg p-4 h-full`;
                columnEl.innerHTML = `<h2 class="text-lg font-bold text-white mb-4 pl-2 border-l-4" style="border-color: ${column.borderColor};">${column.title}</h2><div class="card-container flex-1 space-y-4 rounded-md p-1 -m-1 min-h-[200px]" data-column-id="${column.id}"></div>`;
                const cardContainer = columnEl.querySelector('.card-container');
                addDragDropListeners(cardContainer);
                kanbanBoard.appendChild(columnEl);
            });

            ideas.forEach((idea, index) => {
                const userVote = userVotes[idea.id];
                const targetColumnId = userVote || 'ideas';
                const targetContainer = document.querySelector(`.card-container[data-column-id="${targetColumnId}"]`);
                if(targetContainer) {
                    const card = createIdeaCard(idea, 'voting');
                    card.style.animationDelay = `${index * 50}ms`;
                    targetContainer.appendChild(card);
                }
            });
        }
        
        function renderResultsView() {
            resultsList.innerHTML = '<p class="text-center text-gray-400">Result synthesis is disabled in local mode.</p>';
        }
        
        function createIdeaCard(ideaData) {
            const card = document.createElement('div');
            card.id = ideaData.id;
            const authorColorClass = teamColors[ideaData.author] || teamColors['Default'];
            
            card.className = `idea-card bg-gray-900 p-4 rounded-lg shadow-md fade-in-up border-l-4 ${authorColorClass}`;
            card.draggable = true;

            let suggestionsHtml = '';
            if (ideaData.suggestions && ideaData.suggestions.length > 0) {
                suggestionsHtml = `
                    <div class="mt-4 pt-3 border-t border-gray-700 space-y-3">
                        ${ideaData.suggestions.map(sugg => `
                            <div class="suggestion bg-gray-800/50 p-2 rounded-md">
                                <p class="text-sm text-gray-300">${sugg.text}</p>
                                <p class="text-xs text-right font-semibold text-indigo-400 mt-1">- ${sugg.author}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            let buttonsHtml = `
                <div class="flex items-center justify-end space-x-2 mt-4 pt-3 border-t border-gray-700">
                    <button data-suggest-id="${ideaData.id}" class="suggest-btn text-xs font-semibold text-gray-400 hover:text-white transition">Suggest</button>
            `;
            if (ideaData.author === currentUser) {
                buttonsHtml += `<button data-edit-id="${ideaData.id}" class="edit-btn text-xs font-semibold text-gray-400 hover:text-white transition">Edit</button>`;
            }
            buttonsHtml += `</div>`;
            
            card.innerHTML = `
                <h3 class="font-bold text-white">${ideaData.title}</h3>
                <p class="text-sm text-gray-400 mt-1">${ideaData.description}</p>
                <div class="text-xs text-gray-500 font-semibold mt-3">Author: ${ideaData.author}</div>
                ${suggestionsHtml}
                ${buttonsHtml}
            `;

            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.closest('.idea-card').id);
                setTimeout(() => e.target.closest('.idea-card').classList.add('dragging'), 0);
            });
            card.addEventListener('dragend', (e) => e.target.closest('.idea-card').classList.remove('dragging'));
            
            return card;
        }

        // --- DRAG & DROP LOGIC ---
        function addDragDropListeners(container) {
            container.addEventListener('dragover', (e) => { e.preventDefault(); container.classList.add('drag-over'); });
            container.addEventListener('dragleave', () => container.classList.remove('drag-over'));
            container.addEventListener('drop', async (e) => {
                e.preventDefault();
                container.classList.remove('drag-over');
                const ideaId = e.dataTransfer.getData('text/plain');
                const columnId = container.dataset.columnId;
                if (ideaId && columnId) {
                    userVotes[ideaId] = columnId;
                    renderVotingBoard();
                }
            });
        }
        
        // --- EVENT HANDLERS ---
        document.getElementById('app-container').addEventListener('click', (e) => {
            if (e.target.matches('.edit-btn')) {
                const ideaId = e.target.dataset.editId;
                const ideaToEdit = ideas.find(idea => idea.id === ideaId);
                if (ideaToEdit && ideaToEdit.author === currentUser) {
                    ideaModalTitle.textContent = 'Edit Concept';
                    ideaIdInput.value = ideaToEdit.id;
                    document.getElementById('idea-title').value = ideaToEdit.title;
                    document.getElementById('idea-description').value = ideaToEdit.description;
                    ideaModal.style.display = 'flex';
                }
            }
            if (e.target.matches('.suggest-btn')) {
                const ideaId = e.target.dataset.suggestId;
                suggestionIdeaIdInput.value = ideaId;
                suggestionModal.style.display = 'flex';
            }
        });
        
        addIdeaBtn.addEventListener('click', () => {
            ideaForm.reset();
            ideaIdInput.value = ''; // Ensure we are in "add" mode
            ideaModalTitle.textContent = 'Propose a New Concept';
            ideaModal.style.display = 'flex';
        });

        cancelIdeaBtn.addEventListener('click', () => ideaModal.style.display = 'none');
        ideaModal.addEventListener('click', (e) => { if(e.target === ideaModal) ideaModal.style.display = 'none'; });

        ideaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('idea-title').value.trim();
            const description = document.getElementById('idea-description').value.trim();
            const id = ideaIdInput.value;

            if (id) { // Editing existing idea
                const idea = ideas.find(i => i.id === id);
                if(idea && idea.author === currentUser) { // Authorization check
                    idea.title = title;
                    idea.description = description;
                } else {
                    console.error("Authorization Error: User does not have permission to edit this idea.");
                }
            } else { // Adding new idea
                const newIdea = {
                    id: `mock${ideas.length + 1}`,
                    title, description, author: currentUser, suggestions: []
                };
                ideas.push(newIdea);
            }
            
            updateView();
            ideaModal.style.display = 'none';
        });

        cancelSuggestionBtn.addEventListener('click', () => suggestionModal.style.display = 'none');
        suggestionModal.addEventListener('click', (e) => { if(e.target === suggestionModal) suggestionModal.style.display = 'none'; });

        suggestionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const ideaId = suggestionIdeaIdInput.value;
            const text = document.getElementById('suggestion-text').value.trim();
            const idea = ideas.find(i => i.id === ideaId);

            if (idea && text) {
                idea.suggestions.push({ author: currentUser, text });
                updateView();
                suggestionForm.reset();
                suggestionModal.style.display = 'none';
            }
        });

        // --- START THE APP ---
        init();
    </script>
</body>
</html>

